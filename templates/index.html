<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì±„íŒ…ë´‡</title>
    <link rel="stylesheet" href="static\css\styles.css">
</head>
<body>
    <div id="sidebar">
        <div class="title">ì¸ê³µì§€ëŠ¥ ì—…ë¬´ë„ìš°ë¯¸ ğŸ’¡</div>
        <div class="menu-item">
            âš™ï¸ ì„¤ì •
            <ul>
                <li class="sub-menu" onclick="openModal('share-modal')">Confluence</li>
                <li class="sub-menu" onclick="openModal('email-modal')">Email</li>
                <li class="sub-menu" onclick="openModal('calendar-modal')">Calender</li>
            </ul>
        </div>
        <div class="menu-item">
            ğŸ“‚ ê¸°ëŠ¥
            <ul>
                <li class="sub-menu">ë³´ê³ ì„œ ì´ˆì•ˆ ì‘ì„±</li>
                <li class="sub-menu">íšŒì˜ë¡ ì´ˆì•ˆ ì‘ì„±</li>
                <li class="sub-menu">ë¯¸íŒ… ì¼ì • ìƒì„±</li>
            </ul>
        </div>
    </div>
    
    <div id="chat-container">
        <div id="chat-box"></div>
        <div id="input-box">
            <input type="text" id="user-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" onkeydown="handleKeydown(event)">
            <button id="send-button" onclick="sendMessage()">ì „ì†¡</button>
        </div>
    </div>

   <!-- ëª¨ë‹¬ ë‹¤ì´ì–¼ë¡œê·¸ë“¤ -->
   <div id="share-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('share-modal')">&times;</span>
            <h2>Confluence ì •ë³´</h2>
            <label for="access-token">ê°œì¸ìš© ì—‘ì„¸ìŠ¤ í† í°</label><br>
            <input type="text" id="access-token" name="access-token"><br><br>
            <label for="login-account">ë¡œê·¸ì¸ ê³„ì •</label><br>
            <input type="text" id="login-account" name="login-account"><br><br><br><br>
            <button id="save-button" onclick="saveShare()">Save</button>
        </div>
    </div>

    <div id="email-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('email-modal')">&times;</span>
            <h2>Email ì •ë³´</h2>
            <label for="email-id">ì•„ì´ë””</label><br>
            <input type="text" id="email-id" name="email-id"><br><br>
            <label for="email-password">íŒ¨ìŠ¤ì›Œë“œ</label><br>
            <input type="text" id="email-password" name="email-password"><br><br><br><br>
            <button id="save-button" onclick="saveEmail()">Save</button>
        </div>
    </div>

    <div id="calendar-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('calendar-modal')">&times;</span>
            <h2>Calendar</h2>
            <br><br>
            <button id="save-button" onclick="saveCalendar()">Save</button>
        </div>
    </div>

    <script>
        async function sendMessage() {
            var userInput = document.getElementById('user-input').value;
            if (userInput.trim() !== '') {
                var chatBox = document.getElementById('chat-box');
                var userMessageContainer = document.createElement('div');
                userMessageContainer.classList.add('message-container', 'user-message-container');
                
                var userMessageBubble = document.createElement('div');
                userMessageBubble.classList.add('message-bubble', 'user-message-bubble');
                userMessageBubble.textContent = userInput;

                userMessageContainer.appendChild(userMessageBubble);
                chatBox.appendChild(userMessageContainer);

                // ëŒ€ê¸° ì¤‘ì¸ ë©”ì‹œì§€ë¥¼ í‘œì‹œ
                var waitingMessageContainer = document.createElement('div');
                waitingMessageContainer.id = 'waiting-message';
                waitingMessageContainer.classList.add('message-container', 'waiting-message-container', 'message-animation');
                var waitingMessageBubble = document.createElement('div');
                waitingMessageBubble.classList.add('message-bubble', 'waiting-message-bubble');
                waitingMessageBubble.textContent = '. . .';
                waitingMessageContainer.appendChild(waitingMessageBubble);
                chatBox.appendChild(waitingMessageContainer);

                // ìŠ¤í¬ë¡¤ì„ í•­ìƒ ìµœí•˜ë‹¨ìœ¼ë¡œ ì¡°ì •
                chatBox.scrollTop = chatBox.scrollHeight;

                document.getElementById('user-input').value = '';
                
                // http post ìš”ì²­
                var response = await fetch('/send-message/',{
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_input: userInput })
                });
                var data = await response.json();

                displayBotMessage(data.message);
                
                chatBox.removeChild(waitingMessageContainer);
            }
        }
        function displayBotMessage(message) {
            var chatBox = document.getElementById('chat-box');
            var botMessageContainer = document.createElement('div');
            botMessageContainer.classList.add('message-container', 'bot-message-container');

            var botMessageBubble = document.createElement('div');
            botMessageBubble.classList.add('message-bubble', 'bot-message-bubble');
            botMessageBubble.textContent = message;

            botMessageContainer.appendChild(botMessageBubble);
            chatBox.appendChild(botMessageContainer);

            // ìŠ¤í¬ë¡¤ì„ í•­ìƒ ìµœí•˜ë‹¨ìœ¼ë¡œ ì¡°ì •
            chatBox.scrollTop = chatBox.scrollHeight;
            // ëŒ€ê¸° ì¤‘ì¸ ë©”ì‹œì§€ê°€ ìˆìœ¼ë©´ ì‚­ì œ
            var waitingMessage = document.getElementById('waiting-message');
            if (waitingMessage) {
                chatBox.removeChild(waitingMessage);
            }
        }

        function handleKeydown(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }
        // ëª¨ë‹¬ ì—´ê¸°
        function openModal(modalId) {
            var modal = document.getElementById(modalId);
            modal.style.display = "block";
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal(modalId) {
            var modal = document.getElementById(modalId);
            modal.style.display = "none";
        }

        // ì‚¬ìš©ìê°€ ëª¨ë‹¬ ì™¸ë¶€ë¥¼ í´ë¦­í–ˆì„ ë•Œ ëª¨ë‹¬ ë‹«ê¸°
        window.onclick = function(event) {
            var modals = document.getElementsByClassName('modal');
            for (var i = 0; i < modals.length; i++) {
                var modal = modals[i];
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
        }
        // ì„¤ì • ì •ë³´ ì €ì¥ ë©”ì†Œë“œ
        function saveShare() {
            var accessToken = document.getElementById('access-token').value;
            var loginAccount = document.getElementById('login-account').value;

            console.log("Access Token:", accessToken);
            console.log("Login Account:", loginAccount);

            // í•„ìš”í•œ ì €ì¥ ë˜ëŠ” ì²˜ë¦¬ ë¡œì§ì„ ì¶”ê°€í•˜ì„¸ìš”.

            // ëª¨ë‹¬ ë‹«ê¸°
            closeModal('share-modal');
        }
        function saveEmail() {
            var id = document.getElementById('email-id').value;
            var pw = document.getElementById('email-password').value;

            console.log("Email Id:", id);
            console.log("Email Password:", pw);
            

            // í•„ìš”í•œ ì €ì¥ ë˜ëŠ” ì²˜ë¦¬ ë¡œì§ì„ ì¶”ê°€í•˜ì„¸ìš”.

            // ëª¨ë‹¬ ë‹«ê¸°
            closeModal('email-modal');
        }
        function saveCalendar() {
            // í•„ìš”í•œ ì €ì¥ ë˜ëŠ” ì²˜ë¦¬ ë¡œì§ì„ ì¶”ê°€í•˜ì„¸ìš”.

            // ëª¨ë‹¬ ë‹«ê¸°
            closeModal('calendar-modal');
        }
    </script>
</body>
</html>
